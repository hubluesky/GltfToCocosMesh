# Cocos模型替换

### Cocos模型简介：

    Cocos支持两种3D模型导入格式，一种是FBX，一种是GLTF，不管是那一种格式，在导入Cocos编辑器后，会由编辑器把3D模型转换为Cocos的模型格式.mesh，Cocos的模型格式是由.mesh和.meta两部分组成，meta文件描述了模型的存储信息，比喻顶点坐标、纹理坐标、索引信息的存储格式等等，而mesh则是以二进制的方式存储这些信息。

### 模型替换原理：

    将3D文件FBX或者是GLTF文件内容读取出来，然后按Cocos的meta描述信息，写成一个mesh二进制文件，然后再把meta文件和mesh文件替换发布后的模型对应文件即可。

#### 实现步骤：

1. 导出Cocos模型的.mesh和.meta文件，需要在Cocos打包工具中支持把Cocos的.mesh和对应的.meta文件导出来。
2. 读取3D文件，FBX文件的格式是由Autodesk公司为3DMax开发的一种3D文件格式，格式内容更多是偏向3D软件的，而且是一种封闭格式，而GLTF格式是为一种开放的格式，有更为容易理解的格式布局与存储方式。为而我们先将FBX转成GLTF格式，然后再从GLTF格式中读取数据。
3. 了解Cocos的mesh代码格式，需要从Cocos的引擎源码中查看Mesh的读取方式，反现推导出写入的方式。
4. 根据打包出来的.meta文件信息，开始从GLTF读取出来的数据中，查找meta所需要的信息，比喻meta中描述了这个模型有顶点、法线，纹理坐标，切线等信息，那就从GLTF中找到对应的数据，如果GLTF文件中没有对应的数据，比喻法线，切线等，需要自己计算出来。
5. 从meta文件中了解到这个模型的所需要的数据，并且从GLTF读的出数据中获取相应的数据后，再按mesh的所要求的格式，写成一个要替换的mesh格式。
